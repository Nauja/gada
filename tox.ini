[tox]
envlist = begin,py{38},py{39},end

[gh-actions]
python =
    3.8: py38
    3.9: py39

[pytest]
markers =
    parser: only run test_parser
    typing: only run test_typing

[testenv]
deps =
    coverage
    pytest
    sphinx_autodoc_typehints
    sphinx_rtd_theme
    m2r2
setenv = PYTHONPATH = {toxinidir}/test

[testenv:begin]
commands = coverage erase

[testenv:py38]
commands =
    coverage run -m pytest -s test {posargs}
    coverage run -a -m pytest --doctest-modules --pyargs gada {posargs}

[testenv:py39]
commands =
    coverage run -m pytest -s test {posargs}
    coverage run -a -m pytest --doctest-modules --pyargs gada {posargs}

[testenv:end]
commands =
    coverage report --omit='.tox/*,test/*'
    coverage xml --omit='.tox/*,test/*'

[testenv:parser]
commands =
    antlr -Dlanguage=Python3 {toxinidir}/gada/parser/dist/Gada.g4 -visitor

[testenv:doc]
commands =
    sphinx-build -b html {toxinidir}/docs {toxinidir}/docs/build
